var app=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function i(t){return"function"==typeof t}function s(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function r(n,...e){if(null==n)return t;const o=n.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}function c(t){let n;return r(t,(t=>n=t))(),n}function l(t,n,e){t.$$.on_destroy.push(r(n,e))}function u(t,n,e,o){return t[1]&&o?function(t,n){for(const e in n)t[e]=n[e];return t}(e.ctx.slice(),t[1](o(n))):e.ctx}function a(t,n,e,o,i,s,r){const c=function(t,n,e,o){if(t[2]&&o){const i=t[2](o(e));if(void 0===n.dirty)return i;if("object"==typeof i){const t=[],e=Math.max(n.dirty.length,i.length);for(let o=0;o<e;o+=1)t[o]=n.dirty[o]|i[o];return t}return n.dirty|i}return n.dirty}(n,o,i,s);if(c){const i=u(n,e,o,r);t.p(i,c)}}function f(t){return null==t?"":t}function d(t,n,e=n){return t.set(e),n}const p="undefined"!=typeof window;let y=p?()=>window.performance.now():()=>Date.now(),x=p?t=>requestAnimationFrame(t):t;const h=new Set;function m(t){h.forEach((n=>{n.c(t)||(h.delete(n),n.f())})),0!==h.size&&x(m)}function $(t,n){t.appendChild(n)}function g(t,n,e){t.insertBefore(n,e||null)}function w(t){t.parentNode.removeChild(t)}function v(t){return document.createElement(t)}function b(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function E(t){return document.createTextNode(t)}function S(){return E(" ")}function _(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function O(t){return function(n){return n.preventDefault(),t.call(this,n)}}function M(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function I(t,n,e,o){t.style.setProperty(n,e,o?"important":"")}let T;function D(t){T=t}function L(){const t=function(){if(!T)throw new Error("Function called outside component initialization");return T}();return(n,e)=>{const o=t.$$.callbacks[n];if(o){const i=function(t,n){const e=document.createEvent("CustomEvent");return e.initCustomEvent(t,!1,!1,n),e}(n,e);o.slice().forEach((n=>{n.call(t,i)}))}}}function k(t,n){const e=t.$$.callbacks[n.type];e&&e.slice().forEach((t=>t(n)))}const A=[],C=[],X=[],B=[],j=Promise.resolve();let P=!1;function N(t){X.push(t)}let V=!1;const Y=new Set;function R(){if(!V){V=!0;do{for(let t=0;t<A.length;t+=1){const n=A[t];D(n),U(n.$$)}for(D(null),A.length=0;C.length;)C.pop()();for(let t=0;t<X.length;t+=1){const n=X[t];Y.has(n)||(Y.add(n),n())}X.length=0}while(A.length);for(;B.length;)B.pop()();P=!1,V=!1,Y.clear()}}function U(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(N)}}const Z=new Set;let q;function z(){q={r:0,c:[],p:q}}function G(){q.r||o(q.c),q=q.p}function F(t,n){t&&t.i&&(Z.delete(t),t.i(n))}function W(t,n,e,o){if(t&&t.o){if(Z.has(t))return;Z.add(t),q.c.push((()=>{Z.delete(t),o&&(e&&t.d(1),o())})),t.o(n)}}function H(t){t&&t.c()}function J(t,e,s){const{fragment:r,on_mount:c,on_destroy:l,after_update:u}=t.$$;r&&r.m(e,s),N((()=>{const e=c.map(n).filter(i);l?l.push(...e):o(e),t.$$.on_mount=[]})),u.forEach(N)}function K(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function Q(t,n){-1===t.$$.dirty[0]&&(A.push(t),P||(P=!0,j.then(R)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function tt(n,i,s,r,c,l,u=[-1]){const a=T;D(n);const f=n.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:e(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:e(),dirty:u,skip_bound:!1};let d=!1;if(f.ctx=s?s(n,i.props||{},((t,e,...o)=>{const i=o.length?o[0]:e;return f.ctx&&c(f.ctx[t],f.ctx[t]=i)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](i),d&&Q(n,t)),e})):[],f.update(),d=!0,o(f.before_update),f.fragment=!!r&&r(f.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);f.fragment&&f.fragment.l(t),t.forEach(w)}else f.fragment&&f.fragment.c();i.intro&&F(n.$$.fragment),J(n,i.target,i.anchor),R()}D(a)}class nt{$destroy(){K(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const et=[];function ot(n,e=t){let o;const i=[];function r(t){if(s(n,t)&&(n=t,o)){const t=!et.length;for(let t=0;t<i.length;t+=1){const e=i[t];e[1](),et.push(e,n)}if(t){for(let t=0;t<et.length;t+=2)et[t][0](et[t+1]);et.length=0}}}return{set:r,update:function(t){r(t(n))},subscribe:function(s,c=t){const l=[s,c];return i.push(l),1===i.length&&(o=e(r)||t),s(n),()=>{const t=i.indexOf(l);-1!==t&&i.splice(t,1),0===i.length&&(o(),o=null)}}}}function it(t){return"[object Date]"===Object.prototype.toString.call(t)}function st(t,n,e,o){if("number"==typeof e||it(e)){const i=o-e,s=(e-n)/(t.dt||1/60),r=(s+(t.opts.stiffness*i-t.opts.damping*s)*t.inv_mass)*t.dt;return Math.abs(r)<t.opts.precision&&Math.abs(i)<t.opts.precision?o:(t.settled=!1,it(e)?new Date(e.getTime()+r):e+r)}if(Array.isArray(e))return e.map(((i,s)=>st(t,n[s],e[s],o[s])));if("object"==typeof e){const i={};for(const s in e)i[s]=st(t,n[s],e[s],o[s]);return i}throw new Error(`Cannot spring ${typeof e} values`)}function rt(t,n={}){const e=ot(t),{stiffness:o=.15,damping:i=.8,precision:s=.01}=n;let r,c,l,u=t,a=t,f=1,d=0,p=!1;function $(n,o={}){a=n;const i=l={};if(null==t||o.hard||g.stiffness>=1&&g.damping>=1)return p=!0,r=y(),u=n,e.set(t=a),Promise.resolve();if(o.soft){const t=!0===o.soft?.5:+o.soft;d=1/(60*t),f=0}return c||(r=y(),p=!1,c=function(t){let n;return 0===h.size&&x(m),{promise:new Promise((e=>{h.add(n={c:t,f:e})})),abort(){h.delete(n)}}}((n=>{if(p)return p=!1,c=null,!1;f=Math.min(f+d,1);const o={inv_mass:f,opts:g,settled:!0,dt:60*(n-r)/1e3},i=st(o,u,t,a);return r=n,u=t,e.set(t=i),o.settled&&(c=null),!o.settled}))),new Promise((t=>{c.promise.then((()=>{i===l&&t()}))}))}const g={set:$,update:(n,e)=>$(n(a,t),e),subscribe:e.subscribe,stiffness:o,damping:i,precision:s};return g}function ct(n){let e;return{c(){e=v("div"),e.textContent="this is an image element",M(e,"class","svelte-108a3i5")},m(t,n){g(t,e,n)},p:t,i:t,o:t,d(t){t&&w(e)}}}class lt extends nt{constructor(t){super(),tt(this,t,null,ct,s,{})}}const ut=ot({x:0,y:0}),at=ot(1),ft=ot(1),dt=ot({x:0,y:0});class pt{constructor(t,n,e,o){this.id="",this.position={x:0,y:0},this.scale={x:10,y:10},this.component=lt,this.inSelectionRange=!1,this.selected=!1,this.id=t,this.position=n,this.scale=e,this.component=o}}const yt=ot([new pt("asdfsjakldfldsa",{x:0,y:0},{x:100,y:100},lt),new pt("asdfsjakldflddsaf",{x:200,y:200},{x:300,y:300},lt),new pt("asdfsjakldfldsa",{x:300,y:0},{x:100,y:100},lt),new pt("asdfsjakldfldsa",{x:400,y:0},{x:100,y:100},lt),new pt("asdfsjakldfldsa",{x:500,y:0},{x:100,y:100},lt)]);let xt=[];const ht={SELECT:"item.select",SELECT_ADDITIVE:"item.select_additive",MOVE:"item.move"},mt={BOX_SELECT:"canvas.box_select",BOX_SELECT_ADDITIVE:"canvas.box_select_additive",PAN:"canvas.pan",ZOOM_IN:"canvas.zoom_in",ZOOM_OUT:"canvas.zoom_out"},$t={SAVE:"shortcut.save",ALIGN_TOP:"shortcut.align_top"};class gt{constructor(t,n){this.input=[],this.onDown=()=>{},this.onUp=()=>{},this.operation=t,this.input=n}setDown(t){return this.onDown=t,this}setUp(t){return this.onUp=t,this}}let wt=[new gt($t.ALIGN_TOP,["control","arrowup"]),new gt(mt.BOX_SELECT,["leftMouse"]),new gt(mt.BOX_SELECT_ADDITIVE,["shift","leftMouse"]),new gt(mt.PAN,["alt","rightMouse"]),new gt(mt.PAN,["middleMouse"]),new gt(mt.ZOOM_IN,["scrollUp"]),new gt(mt.ZOOM_OUT,["scrollDown"]),new gt(ht.MOVE,["leftMouse"]),new gt(ht.SELECT,["leftMouse"]),new gt(ht.SELECT_ADDITIVE,["shift","leftMouse"])];function vt(t,n,e=null,o=null,i=null){let s=function(){let t={x:0,y:0},n=1;return t=c(ut),n=c(at),{offset:t,scale:n}}();return null!=e&&(s.offset.x=e),null!=o&&(s.offset.y=o),null!=i&&(s.scale=i),{x:(t-s.offset.x)/s.scale,y:(n-s.offset.y)/s.scale}}function bt(t,n,e=null,o=null,i=null){let s;return s={offset:{x:0,y:0},scale:1},null!=e&&(s.offset.x=e),null!=o&&(s.offset.y=o),null!=i&&(s.scale=i),{x:t*s.scale+s.offset.x,y:n*s.scale+s.offset.y}}class Et{static addEach(t,n){if(null!=t&&null!=n)return{x:t.x+n.x,y:t.y+n.y}}static subtractEach(t,n){if(null!=t&&null!=n)return{x:t.x-n.x,y:t.y-n.y}}static multiplyBoth(t,n){if(null!=t&&null!=n)return{x:t.x*n,y:t.y*n}}static multiplyEach(t,n){if(null!=t&&null!=n)return{x:t.x*n.x,y:t.y*n.y}}static getLength(t){if(null!=t)return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}}function St(t,n){let e=!1;return t&&n&&(e=!(t.right<n.left||t.left>n.right||t.bottom<n.top||t.top>n.bottom)),e}const _t=["leftMouse","middleMouse","rightMouse"];function Ot(t,n){xt.includes(t)||xt.push(t)}function Mt(t){xt.includes(t)&&xt.splice(xt.indexOf(t),1)}function It(t,n=xt){let e=wt.filter((n=>n.operation==t));for(let o of e){if(n.toString()==o.input.toString())return!0;for(let e of wt.filter((n=>n.operation!=t)))if(n.toString().includes(e.input.toString()))return!1;if(n.toString().includes(o.input.toString()))return!0}}function Tt(t,n){if(wt.find((t=>t.input.toString()==xt.toString())))try{n.preventDefault()}catch(t){console.warn('Error preventing default for input "',wt.find((t=>t.input.toString()==xt.toString())).operation,'" this may be a bug, or may be fine',"\n",t)}}function Dt(t){let n=wt.filter((t=>t.operation.startsWith("shortcut")));for(let e=0;e<n.length;e++)n[e].input.toString()==xt.toString()&&(n[e].onUp(),Tt(0,t))}function Lt(t){let n=t;return n=n.toLowerCase(),n}function kt(){for(let t of c(yt).filter((t=>t.selected)))t.selected=!1;yt.update((t=>t))}function At(n){let e,i,s,r,c,l,u,a,f,d,p,y;return{c(){e=b("svg"),i=b("defs"),s=b("filter"),r=b("feGaussianBlur"),c=b("feBlend"),l=b("rect"),M(r,"result","blurOut"),M(r,"stdDeviation","10"),M(c,"in","SourceGraphic"),M(c,"in2","blurOut"),M(c,"mode","normal"),M(s,"id","selection-glow"),M(s,"x","-10"),M(s,"y","-10"),M(s,"width","200"),M(s,"height","200"),M(l,"id","selection-box"),M(l,"x","3"),M(l,"y","3"),M(l,"width",u=Math.max(3,n[1].x-6)),M(l,"height",a=Math.max(3,n[1].y-6)),M(l,"rx","5"),M(l,"filter","url(#selection-glow)"),M(l,"class","svelte-vbnion"),M(e,"id","selection"),M(e,"width",f=Math.max(6,n[1].x)),M(e,"height",d=Math.max(6,n[1].y)),I(e,"transform","translate("+n[2].x+"px, "+n[2].y+"px)"),I(e,"visibility",n[0]),M(e,"class","svelte-vbnion")},m(t,o){g(t,e,o),$(e,i),$(i,s),$(s,r),$(s,c),$(e,l),p||(y=[_(window,"mousemove",n[3]),_(window,"mouseup",n[4])],p=!0)},p(t,[n]){2&n&&u!==(u=Math.max(3,t[1].x-6))&&M(l,"width",u),2&n&&a!==(a=Math.max(3,t[1].y-6))&&M(l,"height",a),2&n&&f!==(f=Math.max(6,t[1].x))&&M(e,"width",f),2&n&&d!==(d=Math.max(6,t[1].y))&&M(e,"height",d),4&n&&I(e,"transform","translate("+t[2].x+"px, "+t[2].y+"px)"),1&n&&I(e,"visibility",t[0])},i:t,o:t,d(t){t&&w(e),p=!1,o(y)}}}function Ct(t,n,e){let o,i,s,r;l(t,yt,(t=>e(12,i=t))),l(t,dt,(t=>e(8,s=t))),l(t,ft,(t=>e(9,r=t)));let{visibility:c="hidden"}=n,u={x:0,y:0},a={x:0,y:0},f={x:0,y:0},d=!1;function p(t,n,o){let s=vt(t,n),r=function(t,n){let e={x:0,y:0},o={x:0,y:0};return t.x>n.x?(e.x=n.x,o.x=t.x-n.x):(e.x=t.x,o.x=n.x-t.x),t.y>n.y?(e.y=n.y,o.y=t.y-n.y):(e.y=t.y,o.y=n.y-t.y),{x:e.x,y:e.y,width:o.x,height:o.y}}(u,s);e(6,a={x:r.width,y:r.height}),e(7,f={x:r.x,y:r.y}),e(0,c="visible"),function(t){for(let t of i)St(new DOMRect(f.x,f.y,a.x,a.y),new DOMRect(t.position.x,t.position.y,t.scale.x,t.scale.y))?t.inSelectionRange=!0:t.inSelectionRange=!1;yt.update((t=>t))}()}function y(){for(let t of i)t.inSelectionRange&&(t.selected=!0,t.inSelectionRange=!1);yt.update((t=>t)),d=!1,e(0,c="hidden")}let x={x:0,y:0};return t.$$set=t=>{"visibility"in t&&e(0,c=t.visibility)},t.$$.update=()=>{896&t.$$.dirty&&e(2,o=bt(f.x,f.y,s.x,s.y,r)),576&t.$$.dirty&&e(1,x=Et.multiplyBoth(a,r))},[c,x,o,function(t){!function(t){d&&(It(mt.BOX_SELECT)||It(mt.BOX_SELECT_ADDITIVE)?p(t.clientX,t.clientY):y())}(t)},function(t){d&&xt.toString()!=wt.find((t=>t.operation==mt.BOX_SELECT||mt.BOX_SELECT_ADDITIVE)).input.toString()&&y()},(t,n,o)=>function(t,n,o){d=!0,u=vt(t,n),e(6,a={x:0,y:0}),e(7,f={x:0,y:0}),e(0,c="hidden"),o||kt()}(t,n,o),a,f,s,r]}class Xt extends nt{constructor(t){super(),tt(this,t,Ct,At,s,{visibility:0,backgroundStartBoxSelection:5})}get backgroundStartBoxSelection(){return this.$$.ctx[5]}}function Bt(n){let e,o,i,s,r,c,l;return{c(){e=v("div"),o=b("svg"),i=b("rect"),M(i,"x",s=n[0].x),M(i,"y",r=n[0].y),M(i,"width",c=n[1].x+"px"),M(i,"height",l=n[1].y+"px"),M(o,"width","100000"),M(o,"height","100000"),M(e,"id","selection"),I(e,"--visibility",n[2]),M(e,"class","svelte-1jrx6ho")},m(t,n){g(t,e,n),$(e,o),$(o,i)},p(t,[n]){1&n&&s!==(s=t[0].x)&&M(i,"x",s),1&n&&r!==(r=t[0].y)&&M(i,"y",r),2&n&&c!==(c=t[1].x+"px")&&M(i,"width",c),2&n&&l!==(l=t[1].y+"px")&&M(i,"height",l),4&n&&I(e,"--visibility",t[2])},i:t,o:t,d(t){t&&w(e)}}}function jt(t,n,e){let o,i,s;l(t,yt,(t=>e(6,s=t)));let r={x:0,y:0},c={x:100,y:50},u=!0,a="hidden",f={left:0,right:0,top:0,bottom:0};return t.$$.update=()=>{if(64&t.$$.dirty&&e(5,o=s),32&t.$$.dirty&&e(7,i=o.filter((t=>t.selected))),128&t.$$.dirty&&(i.length>0?e(3,u=!0):e(3,u=!1)),8&t.$$.dirty&&e(2,a=u?"visible":"hidden"),136&t.$$.dirty&&u){let t=i.sort(((t,n)=>t.position.x-n.position.x))[0].position.x,n=i.sort(((t,n)=>-t.position.x-t.scale.x+(n.position.x+n.scale.x))),o=n[0].position.x+n[0].scale.x,s=i.sort(((t,n)=>t.position.y-n.position.y))[0].position.y,r=i.sort(((t,n)=>-t.position.y-t.scale.y+n.position.y+n.scale.y)),c=r[0].position.y+r[0].scale.y;e(4,f={left:t,right:o,top:s,bottom:c})}24&t.$$.dirty&&u&&e(0,r=bt(f.left,f.top)),25&t.$$.dirty&&u&&e(1,c=bt(Et.subtractEach({x:f.right,y:f.bottom},r)))},[r,c,a,u,f,o,s,i]}class Pt extends nt{constructor(t){super(),tt(this,t,jt,Bt,s,{})}}const Nt=t=>({itemId:1&t,position:4&t,scale:8&t}),Vt=t=>({class:"slot",itemId:t[0],position:t[2],scale:t[3]});function Yt(t){let n,e,i,s,r;const c=t[15].default,l=function(t,n,e,o){if(t){const i=u(t,n,e,o);return t[0](i)}}(c,t,t[14],Vt),d=l||function(t){let n;return{c(){n=E("This item has no type")},m(t,e){g(t,n,e)},d(t){t&&w(n)}}}();return{c(){n=v("div"),d&&d.c(),M(n,"id","root"),I(n,"--positionX",t[2].x+"px"),I(n,"--positionY",t[2].y+"px"),I(n,"--scaleX",t[3].x+"px"),I(n,"--scaleY",t[3].y+"px"),I(n,"--canvasZoom",t[4]),M(n,"class",e=f(t[1])+" svelte-jp2xja")},m(e,o){g(e,n,o),d&&d.m(n,null),i=!0,s||(r=[_(window,"mousemove",t[6]),_(window,"mouseup",t[7]),_(n,"mousedown",t[5])],s=!0)},p(t,[o]){l&&l.p&&16397&o&&a(l,c,t,t[14],o,Nt,Vt),(!i||4&o)&&I(n,"--positionX",t[2].x+"px"),(!i||4&o)&&I(n,"--positionY",t[2].y+"px"),(!i||8&o)&&I(n,"--scaleX",t[3].x+"px"),(!i||8&o)&&I(n,"--scaleY",t[3].y+"px"),(!i||16&o)&&I(n,"--canvasZoom",t[4]),(!i||2&o&&e!==(e=f(t[1])+" svelte-jp2xja"))&&M(n,"class",e)},i(t){i||(F(d,t),i=!0)},o(t){W(d,t),i=!1},d(t){t&&w(n),d&&d.d(t),s=!1,o(r)}}}function Rt(t,n,e){let o,i,s,r,c;l(t,ft,(t=>e(9,r=t))),l(t,yt,(t=>e(11,c=t)));let{$$slots:u={},$$scope:a}=n;L();let{itemId:f=""}=n,{itemIndex:d=0}=n,p="",y={x:0,y:0},x={x:1,y:1},h=1,m=!1,$=!1,g=!1,w=!1,v={x:0,y:0};function b(t=!1){console.log(t),console.log("selected ",o.selected),(m||$)&&(t?e(10,o.selected=!o.selected,o):(kt(),e(10,o.selected=!0,o)),yt.update((t=>t))),m=!1,$=!1}return t.$$set=t=>{"itemId"in t&&e(0,f=t.itemId),"itemIndex"in t&&e(8,d=t.itemIndex),"$$scope"in t&&e(14,a=t.$$scope)},t.$$.update=()=>{512&t.$$.dirty&&e(4,h=r),2304&t.$$.dirty&&e(10,o=c[d]),1024&t.$$.dirty&&e(2,y=o.position),1024&t.$$.dirty&&e(3,x=o.scale),1024&t.$$.dirty&&e(12,i=o.selected),1024&t.$$.dirty&&e(13,s=o.inSelectionRange),12288&t.$$.dirty&&e(1,p=i?"root selected":s?"root test":"root selectable")},[f,p,y,x,h,function(t){Ot(_t[t.button]),It(ht.SELECT)&&(m=!0),It(ht.SELECT_ADDITIVE)&&($=!0),It(ht.MOVE)&&(g=!0,v={x:t.clientX,y:t.clientY})},function(t){if(!w){let n=Et.subtractEach({x:t.clientX,y:t.clientY},v);Et.getLength(n)>20&&(w=!0)}It(ht.MOVE)&&g&&w&&(i||(kt(),e(10,o.selected=!0,o)),function(t,n){for(let e of c.filter((t=>1==t.selected))){let o=Et.multiplyBoth({x:t,y:n},1/r);e.position=Et.addEach(e.position,o)}yt.update((t=>t))}(t.movementX/devicePixelRatio,t.movementY/devicePixelRatio),m=!1,$=!1)},function(t){It(ht.MOVE)||(g=!1,w=!1),!It(ht.SELECT)&&m&&b(!1),!It(ht.SELECT_ADDITIVE)&&$&&b(!0)},d,r,o,c,i,s,a,u]}class Ut extends nt{constructor(t){super(),tt(this,t,Rt,Yt,s,{itemId:0,itemIndex:8})}}function Zt(t,n,e){const o=t.slice();return o[34]=n[e],o[36]=e,o}function qt(t){let n,e,o;var i=t[34].component;return i&&(n=new i({})),{c(){n&&H(n.$$.fragment),e=S()},m(t,i){n&&J(n,t,i),g(t,e,i),o=!0},p(t,o){if(i!==(i=t[34].component)){if(n){z();const t=n;W(t.$$.fragment,1,0,(()=>{K(t,1)})),G()}i?(n=new i({}),H(n.$$.fragment),F(n.$$.fragment,1),J(n,e.parentNode,e)):n=null}},i(t){o||(n&&F(n.$$.fragment,t),o=!0)},o(t){n&&W(n.$$.fragment,t),o=!1},d(t){n&&K(n,t),t&&w(e)}}}function zt(t){let n,e;return n=new Ut({props:{itemId:t[34].id,itemIndex:t[36],$$slots:{default:[qt]},$$scope:{ctx:t}}}),n.$on("clearselection",kt),{c(){H(n.$$.fragment)},m(t,o){J(n,t,o),e=!0},p(t,e){const o={};8&e[0]&&(o.itemId=t[34].id),8&e[0]|64&e[1]&&(o.$$scope={dirty:e,ctx:t}),n.$set(o)},i(t){e||(F(n.$$.fragment,t),e=!0)},o(t){W(n.$$.fragment,t),e=!1},d(t){K(n,t)}}}function Gt(t){let n,e,i,s,r,c,l,u,a,f,d;s=new Xt({props:{}}),t[13](s),c=new Pt({});let p=t[3],y=[];for(let n=0;n<p.length;n+=1)y[n]=zt(Zt(t,p,n));const x=t=>W(y[t],1,1,(()=>{y[t]=null}));return{c(){n=v("div"),e=v("div"),i=S(),H(s.$$.fragment),r=S(),H(c.$$.fragment),l=S(),u=v("div");for(let t=0;t<y.length;t+=1)y[t].c();M(e,"id","background"),M(e,"class","svelte-19f4qs0"),M(u,"id","contents"),I(u,"transform","translate("+t[0].x+"px,"+t[0].y+"px)scale("+t[1]+","+t[1]+")"),M(u,"class","svelte-19f4qs0"),M(n,"id","canvas"),M(n,"class","svelte-19f4qs0")},m(o,p){g(o,n,p),$(n,e),$(n,i),J(s,n,null),$(n,r),J(c,n,null),$(n,l),$(n,u);for(let t=0;t<y.length;t+=1)y[t].m(u,null);a=!0,f||(d=[_(e,"mousedown",t[4]),_(n,"mousedown",t[5]),_(n,"wheel",t[6])],f=!0)},p(t,n){if(s.$set({}),8&n[0]){let e;for(p=t[3],e=0;e<p.length;e+=1){const o=Zt(t,p,e);y[e]?(y[e].p(o,n),F(y[e],1)):(y[e]=zt(o),y[e].c(),F(y[e],1),y[e].m(u,null))}for(z(),e=p.length;e<y.length;e+=1)x(e);G()}(!a||3&n[0])&&I(u,"transform","translate("+t[0].x+"px,"+t[0].y+"px)scale("+t[1]+","+t[1]+")")},i(t){if(!a){F(s.$$.fragment,t),F(c.$$.fragment,t);for(let t=0;t<p.length;t+=1)F(y[t]);a=!0}},o(t){W(s.$$.fragment,t),W(c.$$.fragment,t),y=y.filter(Boolean);for(let t=0;t<y.length;t+=1)W(y[t]);a=!1},d(e){e&&w(n),t[13](null),K(s),K(c),function(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}(y,e),f=!1,o(d)}}}function Ft(){}function Wt(t,n,e){let o,i,s,r,c,u,a,f,p;function y(t){It(mt.PAN)&&(t.clientX,t.clientY,v=!0,console.log("panstart"))}function x(){v&&It(mt.PAN)&&(v=!1)}l(t,ut,(t=>e(15,i=t))),l(t,at,(t=>e(16,s=t))),l(t,ft,(t=>e(17,u=t))),l(t,dt,(t=>e(18,a=t))),l(t,yt,(t=>e(3,f=t))),document.addEventListener("keydown",(function(t){let n=Lt(t.key);if(t.repeat)return;Ot(n),function(t){let n=wt.filter((t=>t.operation.startsWith("shortcut")));for(let e=0;e<n.length;e++)if(n[e].input.toString()==xt.toString()){try{n[e].onDown()}catch(t){console.error(xt)}Tt(0,t)}}(t),y(t)})),document.addEventListener("keyup",(function(t){t.preventDefault();let n=Lt(t.key);Dt(t),Mt(n),x()})),window.addEventListener("focus",Ft),window.addEventListener("blur",(function(){Dt(null),xt.splice(0,xt.length)})),document.addEventListener("mousedown",(function(t){Ot(_t[t.button])})),document.addEventListener("mouseup",(function(t){Mt(_t[t.button]),x()})),document.addEventListener("mousemove",(function(t){!function(t){v&&It(mt.PAN)&&(n=t.movementX,o=t.movementY,e(9,h.x=h.x+n/devicePixelRatio,h),e(9,h.y=h.y+o/devicePixelRatio,h),m.update((t=>h)));var n,o}(t)}));let h={x:0,y:0};const m=rt({x:0,y:0},{stiffness:1,damping:1,precision:1e-4});l(t,m,(t=>e(11,r=t)));let $={x:0,y:0,s:1};const g=rt({x:0,y:0,s:1},{stiffness:.2,damping:1,precision:1e-4});l(t,g,(t=>e(12,c=t)));let w={x:0,y:0},v=!1;function b(t){e(10,$.s=$.s+t*$.s*.1,$),g.update((t=>$))}return t.$$.update=()=>{1536&t.$$.dirty[0]&&d(ut,i=Et.addEach(h,{x:$.x,y:$.y}),i),1024&t.$$.dirty[0]&&d(at,s=$.s,s),6144&t.$$.dirty[0]&&e(0,w={x:r.x+c.x,y:r.y+c.y}),4096&t.$$.dirty[0]&&e(1,o=c.s),2&t.$$.dirty[0]&&d(ft,u=o,u),1&t.$$.dirty[0]&&d(dt,a=w,a)},[w,o,p,f,function(t){Ot(_t[t.button]),It(mt.BOX_SELECT)&&p.backgroundStartBoxSelection(t.clientX,t.clientY,!1),It(mt.BOX_SELECT_ADDITIVE)&&p.backgroundStartBoxSelection(t.clientX,t.clientY,!0)},function(t){Ot(_t[t.button]),y(t)},function(t){switch(-1*(n=t.deltaY,o=-1,i=1,Math.min(Math.max(n,o),i))){case-1:Ot("scrollDown");break;case 1:Ot("scrollUp")}var n,o,i;const s=vt(t.clientX,t.clientY);!function(){It(mt.ZOOM_IN)&&b(2);It(mt.ZOOM_OUT)&&b(-2)}(),Mt("scrollDown"),Mt("scrollUp");const r=vt(t.clientX,t.clientY,null,null,$.s);let c=Et.multiplyBoth(Et.subtractEach(r,s),$.s);var l,u;l=c.x,u=c.y,e(10,$.x=$.x+l,$),e(10,$.y=$.y+u,$),g.update((t=>$))},m,g,h,$,r,c,function(t){C[t?"unshift":"push"]((()=>{p=t,e(2,p)}))}]}class Ht extends nt{constructor(t){super(),tt(this,t,Wt,Gt,s,{},[-1,-1])}}function Jt(n){let e,i,s,r,c;return i=new Ht({}),{c(){e=v("main"),H(i.$$.fragment)},m(t,o){g(t,e,o),J(i,e,null),s=!0,r||(c=[_(e,"contextmenu",O(n[0])),_(e,"drag",O(n[1])),_(e,"dragstart",O(n[2])),_(e,"dragenter",O(n[3]))],r=!0)},p:t,i(t){s||(F(i.$$.fragment,t),s=!0)},o(t){W(i.$$.fragment,t),s=!1},d(t){t&&w(e),K(i),r=!1,o(c)}}}function Kt(t){return[function(n){k(t,n)},function(n){k(t,n)},function(n){k(t,n)},function(n){k(t,n)}]}return new class extends nt{constructor(t){super(),tt(this,t,Kt,Jt,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
